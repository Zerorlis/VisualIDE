<html>

<head>
    <meta charset="utf-8">
    <title>一个div之间的直线</title>
    <script src="../js/jquery-3.3.1.js"></script>
</head>

<body style="margin: 0px;">
    <div id="div1" style="height:200px;width:200px;border-style: dashed;left: 200px;top: 200px;position: absolute;margin: 0px; border-width: 3px">

    </div>
    <div id="div2" style="height:400px;width:400px;border-style: dashed;left: 900px;top: 500px;position: absolute;margin: 0px;  border-width: 3px; cursor: pointer;">

    </div>

    <svg xmlns="http://www.w3.org/2000/svg" version="1.1" id="lines" style="height:100%;width:100%">

    </svg>
    <div id="mune" style="border-style:solid;position: absolute;margin: 0px; border-width: 3px;display: none;background-color: #ffffff">
        <ul>
            <li>帮助</li>
            <li>设置</li>
            <li>复制</li>
            <li>粘贴</li>
            <li>剪切</li>
        </ul>
    </div>
</body>
<script>
    // 添加一条线，要提供这个线的id和位置。
    function line(x1, y1, x2, y2, id) {
        var main = document.getElementById("lines");
        var line = document.createElementNS("http://www.w3.org/2000/svg", "line", true);
        line.setAttribute("x1", x1);
        line.setAttribute("y1", y1);
        line.setAttribute("x2", x2);
        line.setAttribute("y2", y2);
        line.setAttribute("style", "stroke:rgb(255,0,0);stroke-width:5;cursor:pointer");
        line.setAttribute("id", id);
        // 添加右键菜单属性
        line.addEventListener('contextmenu', function (e) {
            var listBox = document.getElementById('mune');//获取自定义右键菜单
            e.preventDefault();
            var x = e.clientX;
            var y = e.clientY;
            listBox.style.display = 'block';//右键点击时显示菜单框
            listBox.style.left = x + 'px';
            listBox.style.top = y + 'px';
            // 这里下面要修改list里面的所有内容，包括注册的监听器
            document.onclick = function () {
                listBox.style.display = 'none';//再次点击时隐藏菜单框
            }

        });


        // 添加鼠标放上去变化的属性,改变颜色，代表选中
        line.addEventListener('mouseover', function (e) {
            e.currentTarget.style.setProperty("stroke", "rgb(0,0,255"); //设置改颜色
        })
        line.addEventListener('mouseout', function (e) {
            e.currentTarget.style.setProperty("stroke", "rgb(255,0,0"); //设置改颜色
        })
        main.appendChild(line);



    }
    //根据id修改一个已有线的位置
    function moveline( x1, y1, x2, y2,id) {
        var line = document.getElementById(id);
        line.setAttribute("x1", x1);
        line.setAttribute("y1", y1);
        line.setAttribute("x2", x2);
        line.setAttribute("y2", y2);
    }
    
    // 这一段是把那个线画出来。
    var div1 = document.getElementById("div1");
    var div2 = document.getElementById("div2");


    var y1 = div1.offsetTop;
    var x1 = div1.offsetLeft;
    var y2 = div2.offsetTop;
    var x2 = div2.offsetLeft;

    var width1 = div1.offsetWidth;
    var height1 = div1.offsetHeight;
    var width2 = div2.offsetWidth;
    var height2 = div2.offsetHeight;
    line(x1 + width1 / 2, y1 + height1, x2 + width2 / 2, y2, "1");
    document.oncontextmenu = function () { // 这里屏蔽掉默认的右键菜单。
        return false;
    }
    // 被下一个函数调用的函数，代表线的位置变化。
    function moveing() {
        var div1 = document.getElementById("div1");
        var div2 = document.getElementById("div2");


        var y1 = div1.offsetTop;
        var x1 = div1.offsetLeft;
        var y2 = div2.offsetTop;
        var x2 = div2.offsetLeft;

        var width1 = div1.offsetWidth;
        var height1 = div1.offsetHeight;
        var width2 = div2.offsetWidth;
        var height2 = div2.offsetHeight;
        moveline(x1 + width1 / 2, y1 + height1, x2 + width2 / 2, y2, "1")
    }

    // 拖动div的效果
    function addDrawDiv(div) {
        div.addEventListener("mousedown", function (e) {

            var distanceX = e.clientX - div.offsetLeft;
            var distanceY = e.clientY - div.offsetTop;

            document.onmousemove = function (e) { // 这里一定要是document，因为在整个界面里面移动，如果移动太快，就会导致这个不执行，所以选择整个可被移动界面作为要移动的地方。
                div.style.left = e.clientX - distanceX + 'px';
                div.style.top = e.clientY - distanceY + 'px';
                moveing();
            };

            document.onmouseup = function (e) {
                document.onmousemove = null;
                document.onmouseup = null;
            };

        });
    }

    addDrawDiv(document.getElementById("div1"));
    addDrawDiv(document.getElementById("div2"));






</script>

</html>